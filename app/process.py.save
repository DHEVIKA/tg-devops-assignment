import boto3
import pandas as pd
import os
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def main():
    s3 = boto3.client("s3")
    raw_bucket = os.getenv("RAW_BUCKET", "raw-data")
    processed_bucket = os.getenv("PROCESSED_BUCKET", "processed-data")
    input_key = os.getenv("INPUT_KEY", "input.csv")
    output_key = os.getenv("OUTPUT_KEY", "output.csv")

    local_input = "/tmp/input.csv"
    local_output = "/tmp/output.csv"

    logger.info("Downloading s3://%s/%s", raw_bucket, input_key)
    s3.download_file(raw_bucket, input_key, local_input)

    df = pd.read_csv(local_input)
    if "name" in df.columns:
        df["name"] = df["name"].str.upper()

    df.to_csv(local_output, index=False)
    logger.info("Uploading s3://%s/%s", processed_bucket, output_key)
    s3.upload_file(local_output, processed_bucket, output_key)
    logger.info("Processed %s â†’ %s", input_key, output_key)

if __name__ == "__main__":
    main()
